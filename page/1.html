<!DOCTYPE html><html><head><link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&amp;display=swap" rel="stylesheet"/><title>Hlog - Cùng nhau mò mẫm</title><meta name="viewport" content="initial-scale=1.0, width=device-width"/><meta charSet="utf-8"/><meta name="description" content="Cùng nhau chia sẻ kinh nghiệm, mò mẫm kiến thức mới"/><meta property="og:type" content="article"/><meta property="og:title" content="Hlog - Cùng nhau mò mẫm"/><meta property="og:description" content="Cùng nhau chia sẻ kinh nghiệm, mò mẫm kiến thức mới"/><meta property="og:image" content="http://static01.nyt.com/images/2015/02/19/arts/international/19iht-btnumbers19A/19iht-btnumbers19A-facebookJumbo-v2.jpg"/><meta name="next-head-count" content="8"/><link rel="preload" href="/_next/static/css/bdd469c09200cf343ddd.css" as="style"/><link rel="stylesheet" href="/_next/static/css/bdd469c09200cf343ddd.css"/><link rel="preload" href="/_next/static/css/2dc628dd2725afab0e9c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2dc628dd2725afab0e9c.css"/><link rel="preload" href="/_next/static/Kp6pXZafDs1s9UOixcjTg/pages/page/%5Bslug%5D.js" as="script"/><link rel="preload" href="/_next/static/Kp6pXZafDs1s9UOixcjTg/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-b65cab0b00afd201cbda.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.2689030919a9ba0449ff.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.d3a5cad3addbd9214ed4.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-48166c9d9d3fd61cbc12.js" as="script"/><link rel="preload" href="/_next/static/chunks/bdc2c736de0e37f26152a2c5539589dba0fb5633.85be808faefaf941c4af.js" as="script"/></head><body><div id="__next"><div><div><div class="Header_container__13qZs"><h2 class="Header_logo__1ZEvY">Hlog</h2><div><span class="Header_category__10c-V">ReactJS</span><span class="Header_category__10c-V">Docker</span><span class="Header_category__10c-V">GI/CD</span><span class="Header_category__10c-V">Tip</span><span class="Header_category__10c-V">Gitlab</span></div><div></div></div><div style="margin-top:80px"><div class="PostBox_container__32pag"><div class="PostBox_imageContainer__2Jypf" style="background-image:url(&#x27;/images/5-docker-ngon-het-dung-luong-day-la-cach-don-dep/cover.jpg&#x27;)"></div><div class="PostBox_contentContainer__1gRO0"><header class="PostBox_header__2NRif"><h1>Docker ngốn hết dung lượng. Đây là cách dọn dẹp?</h1><p class="PostBox_date__3AxRV">Jun 20 2020</p><span class="PostBox_readDuration__1I_Hy"></span></header><div class="PostBox_body__2m5Fb"><h2>1. Container</h2><h3>1.1. Stop and remove all containers</h3><pre><code class="language-bash">docker stop $(docker ps -aq)
docker rm $(docker ps -aq)</code></pre><h3>1.2. Remove idle container</h3><pre><code class="language-bash">docker rm $(docker ps -a -f stat</code></pre></div></div></div><div class="PostBox_container__32pag"><div class="PostBox_imageContainer__2Jypf" style="background-image:url(&#x27;/images/4-gitlab-cac-tinh-nang-hay-nhung-it-duoc-chu-y/cover.jpg&#x27;)"></div><div class="PostBox_contentContainer__1gRO0"><header class="PostBox_header__2NRif"><h1>Gitlab: Các tính năng hay nhưng ít được chú ý</h1><p class="PostBox_date__3AxRV">Jun 14 2020</p><span class="PostBox_readDuration__1I_Hy"></span></header><div class="PostBox_body__2m5Fb"><p>Có thể nói Gitlab là 1 hệ sinh thái bao gồm các công cụ khá đầy đủ cho việc phát triển phần mềm, bao gồm: git registry, docker registry, CI/CD, task management,... Mĩnh sẽ giới thiệu thêm 1 vài tính</p></div></div></div><div class="PostBox_container__32pag"><div class="PostBox_imageContainer__2Jypf" style="background-image:url(&#x27;/images/3-how-to-trigger-ci/cover.jpg&#x27;)"></div><div class="PostBox_contentContainer__1gRO0"><header class="PostBox_header__2NRif"><h1>Làm thế nào để trigger ci bằng commandline?</h1><p class="PostBox_date__3AxRV">Jun 13 2020</p><span class="PostBox_readDuration__1I_Hy"></span></header><div class="PostBox_body__2m5Fb"><p>Đôi lúc bạn sẽ có nhu cần trigger CI cho 1 repo.</p><p>Làm thế nào nhỉ?</p><h2>Thử cách 1: Vào web ui để tạo 1 pipeline.</h2><p>Với cách này sẽ tốn khá nhiều thời gian, nào là truy cập web, nào là chuyển vào trang</p></div></div></div><div class="PostBox_container__32pag"><div class="PostBox_imageContainer__2Jypf" style="background-image:url(&#x27;/images/2-difference-copy-and-add-in-dockerfile/cover.jpg&#x27;)"></div><div class="PostBox_contentContainer__1gRO0"><header class="PostBox_header__2NRif"><h1>Dockerfile: COPY khác ADD?</h1><p class="PostBox_date__3AxRV">Jun 11 2020</p><span class="PostBox_readDuration__1I_Hy"></span></header><div class="PostBox_body__2m5Fb"><p>Nếu bạn thường build docker image hoặc đọc các tài liệu về docker, thỉnh thoảng bạn sẽ gặp <code>COPY</code> và <code>ADD</code>. Vậy <code>COPY</code> khác <code>ADD</code> có gì khác nhau? Nên sử dụng cái nào?</p><p>Cả <code>COPY</code> và <code>ADD</code> có một chức</p></div></div></div><div class="PostBox_container__32pag"><div class="PostBox_imageContainer__2Jypf" style="background-image:url(&#x27;/images/1-how-do-i-build-this-blog/cover.jpg&#x27;)"></div><div class="PostBox_contentContainer__1gRO0"><header class="PostBox_header__2NRif"><h1>Tôi đã tạo blog này thế nào?</h1><p class="PostBox_date__3AxRV">May 23 2020</p><span class="PostBox_readDuration__1I_Hy"></span></header><div class="PostBox_body__2m5Fb"><h2>Chuẩn bị</h2><ul><li>Kiến thức cơ bản về ReactJS, NextJS</li><li>Soạn thảo văn bản với markdown</li><li>Tài khoản Github</li></ul><h2>Giới thiệu</h2><p>Github có 1 chức năng là Github Page, cho phép chúng ta deploy những website tĩnh</p></div></div></div></div><div class="Paginator_container__1ZAnr"><a class="Paginator_buttonDisable__15pRs">&lt;</a><a class="Paginator_buttonActive__HUihv">1</a><a class="Paginator_buttonDisable__15pRs">&gt;</a></div><div><div class="Footer_content__3hdD7"><div class="Footer_logo__2F2BD">Hlog</div><div class="Footer_iconContainer__3ouva"><a target="_blank" href="https://github.com/phanletrunghieu"><svg class="Footer_logoSvg__XMKMu" data-prefix="fab" data-icon="github-square" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM277.3 415.7c-8.4 1.5-11.5-3.7-11.5-8 0-5.4.2-33 .2-55.3 0-15.6-5.2-25.5-11.3-30.7 37-4.1 76-9.2 76-73.1 0-18.2-6.5-27.3-17.1-39 1.7-4.3 7.4-22-1.7-45-13.9-4.3-45.7 17.9-45.7 17.9-13.2-3.7-27.5-5.6-41.6-5.6-14.1 0-28.4 1.9-41.6 5.6 0 0-31.8-22.2-45.7-17.9-9.1 22.9-3.5 40.6-1.7 45-10.6 11.7-15.6 20.8-15.6 39 0 63.6 37.3 69 74.3 73.1-4.8 4.3-9.1 11.7-10.6 22.3-9.5 4.3-33.8 11.7-48.3-13.9-9.1-15.8-25.5-17.1-25.5-17.1-16.2-.2-1.1 10.2-1.1 10.2 10.8 5 18.4 24.2 18.4 24.2 9.7 29.7 56.1 19.7 56.1 19.7 0 13.9.2 36.5.2 40.6 0 4.3-3 9.5-11.5 8-66-22.1-112.2-84.9-112.2-158.3 0-91.8 70.2-161.5 162-161.5S388 165.6 388 257.4c.1 73.4-44.7 136.3-110.7 158.3zm-98.1-61.1c-1.9.4-3.7-.4-3.9-1.7-.2-1.5 1.1-2.8 3-3.2 1.9-.2 3.7.6 3.9 1.9.3 1.3-1 2.6-3 3zm-9.5-.9c0 1.3-1.5 2.4-3.5 2.4-2.2.2-3.7-.9-3.7-2.4 0-1.3 1.5-2.4 3.5-2.4 1.9-.2 3.7.9 3.7 2.4zm-13.7-1.1c-.4 1.3-2.4 1.9-4.1 1.3-1.9-.4-3.2-1.9-2.8-3.2.4-1.3 2.4-1.9 4.1-1.5 2 .6 3.3 2.1 2.8 3.4zm-12.3-5.4c-.9 1.1-2.8.9-4.3-.6-1.5-1.3-1.9-3.2-.9-4.1.9-1.1 2.8-.9 4.3.6 1.3 1.3 1.8 3.3.9 4.1zm-9.1-9.1c-.9.6-2.6 0-3.7-1.5s-1.1-3.2 0-3.9c1.1-.9 2.8-.2 3.7 1.3 1.1 1.5 1.1 3.3 0 4.1zm-6.5-9.7c-.9.9-2.4.4-3.5-.6-1.1-1.3-1.3-2.8-.4-3.5.9-.9 2.4-.4 3.5.6 1.1 1.3 1.3 2.8.4 3.5zm-6.7-7.4c-.4.9-1.7 1.1-2.8.4-1.3-.6-1.9-1.7-1.5-2.6.4-.6 1.5-.9 2.8-.4 1.3.7 1.9 1.8 1.5 2.6z"></path></svg></a><a target="_blank" href="https://www.linkedin.com/in/phanletrunghieu"><svg class="Footer_logoSvg__XMKMu" data-prefix="fab" data-icon="linkedin" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a><a target="_blank" href="https://www.facebook.com/phanletrunghieu"><svg class="Footer_logoSvg__XMKMu" data-prefix="fab" data-icon="facebook-square" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M400 32H48A48 48 0 0 0 0 80v352a48 48 0 0 0 48 48h137.25V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.27c-30.81 0-40.42 19.12-40.42 38.73V256h68.78l-11 71.69h-57.78V480H400a48 48 0 0 0 48-48V80a48 48 0 0 0-48-48z"></path></svg></a></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"categories":["ReactJS","Docker","GI/CD","Tip","Gitlab"],"allBlogs":[{"frontmatter":{"author":"Hieu Phan","date":"2020-06-20T09:26:00.000Z","image":"/images/5-docker-ngon-het-dung-luong-day-la-cach-don-dep/cover.jpg","title":"Docker ngốn hết dung lượng. Đây là cách dọn dẹp?","readDuration":"15 min","categories":["Docker"]},"markdownBody":"\n\n## 1. Container\n### 1.1. Stop and remove all containers\n\n```bash\ndocker stop $(docker ps -aq)\ndocker rm $(docker ps -aq)\n```\n\n### 1.2. Remove idle container\n\n```bash\ndocker rm $(docker ps -a -f status=exited -f status=created -q)\n```\n\n## 2. Volume\n### 2.1. Remove dangling volumes\nYêu cầu: Docker 1.9 and later\n\nDangling volumes là những volumes không liên kết với bất kỳ 1 container nào.\n\n```bash\ndocker volume prune\n```\n\n### 2.2. Remove container \u0026 it's volumes\n\n```bash\ndocker rm -v container_name\n```\n\n## 3. Image\n### 3.1. Remove unsed images\n\n```bash\ndocker rmi $(docker images -a -q)\n```\n\n### 3.2. Remove dangling images\n\nDangling images là những images có tag là `\u003cnone\u003e`.\n\nKhi bạn dùng multistage để build 1 image thì sẽ xuất hiện những images kiểu thế này. Việc giữ lại những image này sẽ giúp bạn build nhanh hơn trong những lần tới, nhưng thường nó cũng ngốn dung lượng khá lớn. Hãy cân nhắc kỹ trước khi xóa nó.\n\n**List**\n```bash\ndocker images -f dangling=true\n```\n\n**Remove**\n```bash\ndocker images purge\n```\n\n## 4. Remove Unused/Dangling Images, Containers, Volumes, and Networks\n\nDocker cung cấp 1 command duy nhất để xóa những thứ không cần thiết. Bạn có thể thử. Nhưng nếu 1 ngày bạn chạy lệnh này rồi mà thấy đĩa cứng vẫn bị ngốn dung lượng một cách bí ẩn, hãy thử dùng các lệnh ở trên.\n\n```bash\ndocker system prune\n```\n\n**Include unused images (not just dangling images)**\n```bash\ndocker system prune -a\n```","slug":"5-docker-ngon-het-dung-luong-day-la-cach-don-dep"},{"frontmatter":{"author":"Hieu Phan","date":"2020-06-14T11:56:00.000Z","image":"/images/4-gitlab-cac-tinh-nang-hay-nhung-it-duoc-chu-y/cover.jpg","title":"Gitlab: Các tính năng hay nhưng ít được chú ý","readDuration":"15 min","categories":["Gitlab"]},"markdownBody":"\nCó thể nói Gitlab là 1 hệ sinh thái bao gồm các công cụ khá đầy đủ cho việc phát triển phần mềm, bao gồm: git registry, docker registry, CI/CD, task management,... Mĩnh sẽ giới thiệu thêm 1 vài tính năng nhỏ, nhưng rất hay\n\n## 1. Gitlab CI Template\n\n**Template trong cùng 1 file `.gitlab-ci.yml`**\n\n```yaml\nvariables:\n  GIT_CLEAN_FLAGS: none\n  IMAGE_NAME: registry.domain.com/app/payment_service\n  \n.build:\n  image: docker:stable\n  stage: build\n  services:\n    - docker:dind\n  script:\n    - mkdir -p ~/.docker\n    - echo $DOCKER_AUTH_CONFIG \u003e ~/.docker/config.json\n    - docker build -t $IMAGE_NAME:$IMAGE_TAG .\n    - docker push $IMAGE_NAME:$IMAGE_TAG\n\nbuild-stagging:\n  extends: .build\n  variables:\n    IMAGE_TAG: latest-dev\n  only:\n    - master\n\nbuild-prod-version:\n  extends: .build\n  variables:\n    IMAGE_TAG: $CI_COMMIT_TAG\n  only:\n    - tag\n  except:\n    - branches\n\nbuild-prod-latest:\n  extends: .build\n  variables:\n    IMAGE_TAG: latest\n  only:\n    - tag\n  except:\n    - branches\n```\n\nTa sẽ định nghĩa những phần chung của tác vụ build vào `.build`. Trong `.build`, phần script mình có dùng 2 biến môi trường `IMAGE_NAME` và `IMAGE_TAG`. `IMAGE_NAME` thì mình có định nghĩa ở global `variables`. Còn `IMAGE_TAG` được định nghĩa ở đâu?\n\nSau đó ta sẽ định nghĩa những job build khác cho riêng từng môi trường, và extends lại `.build`. Ở đoạn trước mình còn câu hỏi `IMAGE_TAG` được định nghĩa ở đâu, thì ở từng môi trường mình sẽ build ra 1 docker image với 1 tag khác nhau. Vậy ở mỗi job extend từ `.build` ta sẽ thêm `IMAGE_TAG` vào `variables`, nó sẽ tự động gắn vào scripts trước đó để chạy.\n\n**Template từ 1 repo khác**\n\nVí dụ ta có 2 project được đặt ở 2 repo. 2 repo này ta có nhu cậu chạy những job giống nhau. Ta có thể tạo 1 repo `gitlab-ci-template` chứa 1 file `template.yml` có nội dung:\n\n```yaml\nvariables:\n  GO111MODULE: on\n  GIT_CLEAN_FLAGS: none\n\nstages:\n  - test\n\ntest:\n  stage: test\n  retry:\n    max: 1\n  only:\n    - master\n    - merge_requests\n  script:\n    - make lint\n    - make test\n```\n\n\nỞ 2 repo kia, ta tạo file `.gitlab-ci.yml` như sau:\n\n```yaml\ninclude:\n  - project: 'example-group/gitlab-ci-template'\n    ref: master\n    file: '/template.yml'\n\nimage: golang:1.14.4-alpine\n```\n\nVậy 2 repo đã có job `test`\n\n## 2. Coverage\n\n![Coverage example](/images/4-gitlab-cac-tinh-nang-hay-nhung-it-duoc-chu-y/coverage-example.png)\n\nVí dụ đối với 1 project sử dụng golang, khi test mình sẽ dùng lệnh\n\n```bash\ngo test -race -v -coverprofile=coverage/coverage.txt.tmp -count=1  ./...\n```\n\nTrong 1 đống kết quả trả về thì có 1 dòng hiển thị test đã coverage bao nhiêu phần trăm\n\n```\ntotal:\t\t\t\t\t(statements)\t93.6%\n```\n\nDùng regex để lấy đoạn này ra là `/total:\\s+\\(statements\\)\\s+(\\d+.\\d+\\%)/`\n\nCuối cùng là gắn regex trên vào `.gitlab-ci.yml` như sau:\n\n```yaml\nunit-test:\n  image: golang:1.14.4-alpine\n  stage: test\n  only:\n    - merge_requests\n  script:\n    - make unit-test\n  coverage: '/total:\\s+\\(statements\\)\\s+(\\d+.\\d+\\%)/'\n```\n\n## 3. Tự động retry job khi fail\n\n[Gitlab document](https://docs.gitlab.com/ee/ci/yaml/#retry)\n\n```yaml\nunit-test:\n  image: golang:1.14.4-alpine\n  stage: test\n  only:\n    - merge_requests\n  script:\n    - make unit-test\n  retry:\n    max: 2\n    when:\n      - runner_system_failure\n      - stuck_or_timeout_failure\n      - stuck_or_timeout_failure\n      - scheduler_failure\n      - api_failure\n```\n","slug":"4-gitlab-cac-tinh-nang-hay-nhung-it-duoc-chu-y"},{"frontmatter":{"author":"Hieu Phan","date":"2020-06-13T16:11:00.000Z","image":"/images/3-how-to-trigger-ci/cover.jpg","title":"Làm thế nào để trigger ci bằng commandline?","readDuration":"5 min","categories":["GI/CD","Tip"]},"markdownBody":"\nĐôi lúc bạn sẽ có nhu cần trigger CI cho 1 repo.\n\nLàm thế nào nhỉ?\n\n## Thử cách 1: Vào web ui để tạo 1 pipeline.\n\nVới cách này sẽ tốn khá nhiều thời gian, nào là truy cập web, nào là chuyển vào trang pipeline của repo,...\n\n=\u003e Mất thời gian\n\n## Thử cách 2: Change code \u003e commit -\u003e push\n\nCòn với cách này sẽ nhanh hơn cách thứ 1, nhưng phải change code, và sẽ có 2 trường hợp:\n- 1 commit để change code, thêm 1 commit nữa để restore code về như cũ.\n- Tìm 1 chỗ nào đó không ảnh hưởng đến code khi chạy để thay đổi, ví dụ là comment.\n\n=\u003e Hơi phức tạp\n\n## 1 solution có tiện hơn chăng?\n\nTheo nguyên lý hoạt động thì CI sẽ trigger khi có 1 commit mới.\n\n\u003e Vậy ta chỉ cần commit mà không change code\n\n```bash\ngit commit --allow-empty -m \"Trigger ci\"\n```","slug":"3-how-to-trigger-ci"},{"frontmatter":{"author":"Hieu Phan","date":"2020-06-11T14:55:00.000Z","image":"/images/2-difference-copy-and-add-in-dockerfile/cover.jpg","title":"Dockerfile: COPY khác ADD?","readDuration":"10 min","categories":["Docker"]},"markdownBody":"\nNếu bạn thường build docker image hoặc đọc các tài liệu về docker, thỉnh thoảng bạn sẽ gặp `COPY` và `ADD`. Vậy `COPY` khác `ADD` có gì khác nhau? Nên sử dụng cái nào?\n\nCả `COPY` và `ADD` có một chức năng chung là chép file từ 1 nơi nào đó vào bên trong docker image. Còn điểm khác nhau?\n\n## COPY\n\n`COPY` cho phép bạn chép 1 file từ đĩa cứng vào docker image.\n\n## ADD\n\n`ADD`ngoài chức năng chép file từ đĩa cứng, còn hỗ trợ chép file từ 2 nguồn khác là:\n- Chép file từ 1 URL\n- Giải nén file tar vào docker image. Ví dụ `ADD http://abc.com/app.tar.xz /app/`, các file bên trong file `app.tar.xz` sẽ được chép vào `/app/` trong docker image.\n\n## Khi nào nên dùng `COPY`, khi nào nên dùng `ADD`?\nRiêng cá nhân mình, thì mình đa số dùng `COPY`, và rất ít dùng `ADD`. Vậy có phải mình đã bỏ qua 1 tính của docker là chép file từ url hay giải nén.\n\n\u003e Docker image khi build sẽ tạo ra nhiều layer. Ứng với mỗi lệnh trong Dockerfile, sẽ có 1 layer được sinh ra. Khi dùng lệnh `ADD` để download file, và file đó sẽ được lưu mãi mãi tại layer của lệnh `ADD` đó. Trường hợp file cần download có dung lượng khoảng vài GB, nhưng chỉ dùng tạm để build app, và có thể xoá cũng không thể ảnh hưởng đến app, thì dùng `ADD` kích thước docker image sẽ rất lớn.\n\n**Tip:** Với việc download file mình sẽ `curl` thay thế cho `ADD`.\nVí dụ\n\n```Dockerfile\nRUN curl -O https://example.com/files/abc.tar.gz \u0026\u0026 \\\n    tar -xzf abc.tar.gz \u0026\u0026 \\\n    echo \"do something\" \u0026\u0026 \\\n    rm -rf abc \u0026\u0026 \\\n    rm abc.tar.gz\n```\n\nNhư vậy docker sẽ lưu lại 1 layer, layer này không có file `abc.tar.gz`","slug":"2-difference-copy-and-add-in-dockerfile"},{"frontmatter":{"author":"Hieu Phan","date":"2020-05-22T17:06:00.000Z","image":"/images/1-how-do-i-build-this-blog/cover.jpg","title":"Tôi đã tạo blog này thế nào?","readDuration":"45 min","categories":["ReactJS"]},"markdownBody":"\n## Chuẩn bị\n- Kiến thức cơ bản về ReactJS, NextJS\n- Soạn thảo văn bản với markdown\n- Tài khoản Github\n\n## Giới thiệu\nGithub có 1 chức năng là Github Page, cho phép chúng ta deploy những website tĩnh (HTML, css, javascript). Trước đây khi nhắc đến việc tạo ra 1 website tĩnh thì ta sẽ nghĩ ngay đến [GatsbyJS](https://www.gatsbyjs.org), còn NextJS là framework mạnh về việc hỗ trợ xây dựng ứng dụng React Server Side Render (SSR) và routing. Nhưng tin vui là vừa qua NextJS đã có thêm tính năng **Static Exporting**.\n\n\u003e **Static Exporting** là gì vậy? Khác gì so với SSR?\n- SSR: server nhận được request -\u003e server render code react thành html -\u003e trả html về client\n- Static: html được tạo ra ngay khi ta build app -\u003e server nhận được request -\u003e trả html về client\n\n## Setup\n\n### Khởi tạo NextJS project\n\n```bash\nnpx create-next-app\n# or\nyarn create next-app\n```\n\nBlog này sẽ được deploy lên Github Page, và để tiện nhất, nhanh nhất, nên sẽ không có chuyện gọi API và lấy data để hiển thị. Dữ liệu blog sẽ được lưu trong những file markdown, mỗi file chứa một bài post.\n\nCấu trúc thư mục:\n- **assets:** các icon, hình ảnh để import trực tiếp vào React\n- **components:** các layout, component của blog (Header, Footer, Meta,...)\n- **data:** file `config.json` chứa các thông tin tổng quát của website (title, description, url,...)\n- **pages:** folder mặc định của NextJS. Mỗi file trong thư mục này tương ứng với 1 trang web.\n- **posts:** chứa các file markdown, nội dung của các bài post trong blog\n- **public:** chủ yếu chứa các hình ảnh chèn vào các bài post\n- **styles:** chứa các file scss, làm đẹp cho web\n\n### Config NextJS load file *.md\n\nCài `raw-loader` cho webpack\n```bash\nyarn add raw-loader\n```\n\nThêm nội dung sau vào file `next.config.js`. (Nếu không có thì tạo)\n\n```js\nmodule.exports = {\n    poweredByHeader: false,\n    webpack: function(config) {\n        config.module.rules.push({\n            test: /\\.md$/,\n            use: 'raw-loader',\n        })\n        return config\n    },\n}\n```\n\n### Config NextJS load icon svg\n\nCài `babel-plugin-inline-react-svg`\n```bash\nyarn add --dev babel-plugin-inline-react-svg\n```\n\nThêm nội dung sau vào file `.babelrc`. (Nếu không có thì tạo)\n\n```json\n{\n    \"presets\": [ \"next/babel\" ],\n    \"plugins\": [ \"inline-react-svg\" ]\n}\n```\n\n### Cài scss\n\nChỉ cần cài module `sass`\n\n```bash\nyarn add sass\n```\n\n## Code\n**Ý tưởng:** NextJS hỗ trợ build static thông qua 2 hàm `getStaticProps` và `getStaticPaths`. 2 hàm này được gọi khi build project. Mỗi file trong thư mục `pages` đều được NextJS hỗ trợ 2 hàm này. \n\n- getStaticProps: với hàm này, ta sẽ đọc dữ liệu từ file .md và truyền vào props của ReactComponent. Trong hàm này ta sẽ thực hiện:\n    - Đối với trang chủ hoặc trang category, ta sẽ đọc nội dung của tất cả file *.md. Truyền data vào props\n    - Đối với trang chi tiết, ta chỉ cần đọc đúng 1 file *md. Ví dụ `/post/abc-de` thì ta cần đọc file `abc-de.md`\n- getStaticPaths: url của 1 bài post là `/post/[slug]`. Ví dụ ta có 2 bài post là `post 1` và `post 2`, thì url là `/post/post-1` và `/post/post-2`. Như vậy trong hàm này, chúng ta sẽ thực hiện các tác vụ\n    - List hết tất cả file *.md trong folder `posts`\n    - Chuẩn hoá tên file thành url. `Post 1` thành `/post/post-1`\n\n## Deploy lên Github Page\n\nBình thường khi export project NextJS thành file html, ta sẽ dùng lệnh\n\n```bash\nnext export\n```\n\nNhưng Github Page sử dụng Jekyll, mà Jekyll thì không đọc được các file có ký tự \"_\" ở đầu (`_next`, `_app.js`). NextJS lại export ra rất nhiều file như thế. Nên ta cần disable Jekyll trong project.\n\nThay đổi các scripts trong file package.json như sau:\n```json\n\"scripts\": {\n    \"dev\": \"next dev\",\n    \"build\": \"next build \u0026\u0026 next export \u0026\u0026 touch out/.nojekyll\",\n    \"start\": \"next start\"\n}\n```\n\nChạy lệnh:\n```bash\nyarn build\n```\n\nNextJS sẽ export file là lưu vào folder `out`. Giờ ta chỉ cần push hết các file trong folder `out` lênn Github.\n\n![out folder](/images/1-how-do-i-build-this-blog/out-folder.png)\n\nURL Github Page sẽ có dạng https://{username}.github.io. Ví dụ: https://phanletrunghieu.github.io.\nVậy làm sao để code trong `out` có thể truy cập được thông qua tên miền trên.\nTạo 1 repo với lên là {username}.github.io (Ví dụ: phanletrunghieu.github.io). Và commit -\u003e push code bên trong `out` lên.\n\nXong!\n\n## Kết\n\n[Project mẫu](https://github.com/phanletrunghieu/myblog)\n","slug":"1-how-do-i-build-this-blog"}],"title":"Hlog - Cùng nhau mò mẫm","description":"Cùng nhau chia sẻ kinh nghiệm, mò mẫm kiến thức mới","currentPage":"1","totalPage":1},"__N_SSG":true},"page":"/page/[slug]","query":{"slug":"1"},"buildId":"Kp6pXZafDs1s9UOixcjTg","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/runtime/polyfills-b6cccdf50789f19d2e76.js"></script><script async="" data-next-page="/page/[slug]" src="/_next/static/Kp6pXZafDs1s9UOixcjTg/pages/page/%5Bslug%5D.js"></script><script async="" data-next-page="/_app" src="/_next/static/Kp6pXZafDs1s9UOixcjTg/pages/_app.js"></script><script src="/_next/static/runtime/webpack-b65cab0b00afd201cbda.js" async=""></script><script src="/_next/static/chunks/framework.2689030919a9ba0449ff.js" async=""></script><script src="/_next/static/chunks/commons.d3a5cad3addbd9214ed4.js" async=""></script><script src="/_next/static/runtime/main-48166c9d9d3fd61cbc12.js" async=""></script><script src="/_next/static/chunks/bdc2c736de0e37f26152a2c5539589dba0fb5633.85be808faefaf941c4af.js" async=""></script><script src="/_next/static/Kp6pXZafDs1s9UOixcjTg/_buildManifest.js" async=""></script><script src="/_next/static/Kp6pXZafDs1s9UOixcjTg/_ssgManifest.js" async=""></script></body></html>