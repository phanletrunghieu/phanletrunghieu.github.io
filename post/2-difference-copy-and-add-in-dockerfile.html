<!DOCTYPE html><html><head><link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&amp;display=swap" rel="stylesheet"/><title>Dockerfile: COPY khác ADD? - Hlog - Code for good, not for food</title><meta name="viewport" content="initial-scale=1.0, width=device-width"/><meta charSet="utf-8"/><meta name="description" content="
Nếu bạn thường build docker image hoặc đọc các tài liệu về docker, thỉnh thoảng bạn sẽ gặp `COPY` và `ADD`. Vậy `COPY` khác `ADD` có gì khác nhau? Nên sử dụng cái nào?

Cả `COPY` và `ADD` có một chức"/><meta property="og:type" content="article"/><meta property="og:title" content="Dockerfile: COPY khác ADD? - Hlog - Code for good, not for food"/><meta property="og:description" content="
Nếu bạn thường build docker image hoặc đọc các tài liệu về docker, thỉnh thoảng bạn sẽ gặp `COPY` và `ADD`. Vậy `COPY` khác `ADD` có gì khác nhau? Nên sử dụng cái nào?

Cả `COPY` và `ADD` có một chức"/><meta property="og:image" content="https://phanletrunghieu.github.io/images/2-difference-copy-and-add-in-dockerfile/cover.jpg"/><meta name="next-head-count" content="8"/><link rel="preload" href="/_next/static/css/dcef9884d0a6a8d579d5.css" as="style"/><link rel="stylesheet" href="/_next/static/css/dcef9884d0a6a8d579d5.css"/><link rel="preload" href="/_next/static/css/21bdaa14f5cc8fc64175.css" as="style"/><link rel="stylesheet" href="/_next/static/css/21bdaa14f5cc8fc64175.css"/><link rel="preload" href="/_next/static/hau1wfguwgaGlbPl6QppC/pages/post/%5Bslug%5D.js" as="script"/><link rel="preload" href="/_next/static/hau1wfguwgaGlbPl6QppC/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-b65cab0b00afd201cbda.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.2689030919a9ba0449ff.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.d3a5cad3addbd9214ed4.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-48166c9d9d3fd61cbc12.js" as="script"/><link rel="preload" href="/_next/static/chunks/befb15d6b0d1c5c733afbaacd2f90d2058634f4f.a144523e91ee69682f24.js" as="script"/></head><body><div id="__next"><div><div><div class="Header_container__13qZs"><h2 class="Header_logo__1ZEvY">Hlog</h2><div><span class="Header_category__10c-V">ReactJS</span><span class="Header_category__10c-V">Docker</span><span class="Header_category__10c-V">GI/CD</span><span class="Header_category__10c-V">Tip</span><span class="Header_category__10c-V">Gitlab</span></div><div></div></div><div style="margin-top:120px;margin-bottom:50px"><div class="Post_headerContainer__2SstR"><h1>Dockerfile: COPY khác ADD?</h1><div class="Post_subHeader__2A2DV"><p class="Post_date__3SBQj">Jun 11 2020</p><span class="Post_readDuration__WqJgS">10 min</span></div></div><div style="background-image:url(/images/2-difference-copy-and-add-in-dockerfile/cover.jpg);background-size:cover;background-position:center;width:100%;height:0"></div><div class="Post_content__3ENjB"><p>Nếu bạn thường build docker image hoặc đọc các tài liệu về docker, thỉnh thoảng bạn sẽ gặp <code>COPY</code> và <code>ADD</code>. Vậy <code>COPY</code> khác <code>ADD</code> có gì khác nhau? Nên sử dụng cái nào?</p><p>Cả <code>COPY</code> và <code>ADD</code> có một chức năng chung là chép file từ 1 nơi nào đó vào bên trong docker image. Còn điểm khác nhau?</p><h2>COPY</h2><p><code>COPY</code> cho phép bạn chép 1 file từ đĩa cứng vào docker image.</p><h2>ADD</h2><p><code>ADD</code>ngoài chức năng chép file từ đĩa cứng, còn hỗ trợ chép file từ 2 nguồn khác là:</p><ul><li>Chép file từ 1 URL</li><li>Giải nén file tar vào docker image. Ví dụ <code>ADD http://abc.com/app.tar.xz /app/</code>, các file bên trong file <code>app.tar.xz</code> sẽ được chép vào <code>/app/</code> trong docker image.</li></ul><h2>Khi nào nên dùng <code>COPY</code>, khi nào nên dùng <code>ADD</code>?</h2><p>Riêng cá nhân mình, thì mình đa số dùng <code>COPY</code>, và rất ít dùng <code>ADD</code>. Vậy có phải mình đã bỏ qua 1 tính của docker là chép file từ url hay giải nén.</p><blockquote><p>Docker image khi build sẽ tạo ra nhiều layer. Ứng với mỗi lệnh trong Dockerfile, sẽ có 1 layer được sinh ra. Khi dùng lệnh <code>ADD</code> để download file, và file đó sẽ được lưu mãi mãi tại layer của lệnh <code>ADD</code> đó. Trường hợp file cần download có dung lượng khoảng vài GB, nhưng chỉ dùng tạm để build app, và có thể xoá cũng không thể ảnh hưởng đến app, thì dùng <code>ADD</code> kích thước docker image sẽ rất lớn.</p></blockquote><p><strong>Tip:</strong> Với việc download file mình sẽ <code>curl</code> thay thế cho <code>ADD</code>.
Ví dụ</p><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">RUN curl -O https://example.com/files/abc.tar.gz &amp;&amp; \
    tar -xzf abc.tar.gz &amp;&amp; \
    echo &quot;do something&quot; &amp;&amp; \
    rm -rf abc &amp;&amp; \
    rm abc.tar.gz</code></pre><p>Như vậy docker sẽ lưu lại 1 layer, layer này không có file <code>abc.tar.gz</code></p></div></div><div><div class="Footer_content__3hdD7"><div class="Footer_logo__2F2BD">Hlog</div><div class="Footer_iconContainer__3ouva"><a target="_blank" href="https://github.com/phanletrunghieu"><svg class="Footer_logoSvg__XMKMu" data-prefix="fab" data-icon="github-square" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM277.3 415.7c-8.4 1.5-11.5-3.7-11.5-8 0-5.4.2-33 .2-55.3 0-15.6-5.2-25.5-11.3-30.7 37-4.1 76-9.2 76-73.1 0-18.2-6.5-27.3-17.1-39 1.7-4.3 7.4-22-1.7-45-13.9-4.3-45.7 17.9-45.7 17.9-13.2-3.7-27.5-5.6-41.6-5.6-14.1 0-28.4 1.9-41.6 5.6 0 0-31.8-22.2-45.7-17.9-9.1 22.9-3.5 40.6-1.7 45-10.6 11.7-15.6 20.8-15.6 39 0 63.6 37.3 69 74.3 73.1-4.8 4.3-9.1 11.7-10.6 22.3-9.5 4.3-33.8 11.7-48.3-13.9-9.1-15.8-25.5-17.1-25.5-17.1-16.2-.2-1.1 10.2-1.1 10.2 10.8 5 18.4 24.2 18.4 24.2 9.7 29.7 56.1 19.7 56.1 19.7 0 13.9.2 36.5.2 40.6 0 4.3-3 9.5-11.5 8-66-22.1-112.2-84.9-112.2-158.3 0-91.8 70.2-161.5 162-161.5S388 165.6 388 257.4c.1 73.4-44.7 136.3-110.7 158.3zm-98.1-61.1c-1.9.4-3.7-.4-3.9-1.7-.2-1.5 1.1-2.8 3-3.2 1.9-.2 3.7.6 3.9 1.9.3 1.3-1 2.6-3 3zm-9.5-.9c0 1.3-1.5 2.4-3.5 2.4-2.2.2-3.7-.9-3.7-2.4 0-1.3 1.5-2.4 3.5-2.4 1.9-.2 3.7.9 3.7 2.4zm-13.7-1.1c-.4 1.3-2.4 1.9-4.1 1.3-1.9-.4-3.2-1.9-2.8-3.2.4-1.3 2.4-1.9 4.1-1.5 2 .6 3.3 2.1 2.8 3.4zm-12.3-5.4c-.9 1.1-2.8.9-4.3-.6-1.5-1.3-1.9-3.2-.9-4.1.9-1.1 2.8-.9 4.3.6 1.3 1.3 1.8 3.3.9 4.1zm-9.1-9.1c-.9.6-2.6 0-3.7-1.5s-1.1-3.2 0-3.9c1.1-.9 2.8-.2 3.7 1.3 1.1 1.5 1.1 3.3 0 4.1zm-6.5-9.7c-.9.9-2.4.4-3.5-.6-1.1-1.3-1.3-2.8-.4-3.5.9-.9 2.4-.4 3.5.6 1.1 1.3 1.3 2.8.4 3.5zm-6.7-7.4c-.4.9-1.7 1.1-2.8.4-1.3-.6-1.9-1.7-1.5-2.6.4-.6 1.5-.9 2.8-.4 1.3.7 1.9 1.8 1.5 2.6z"></path></svg></a><a target="_blank" href="https://www.linkedin.com/in/phanletrunghieu"><svg class="Footer_logoSvg__XMKMu" data-prefix="fab" data-icon="linkedin" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a><a target="_blank" href="https://www.facebook.com/phanletrunghieu"><svg class="Footer_logoSvg__XMKMu" data-prefix="fab" data-icon="facebook-square" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M400 32H48A48 48 0 0 0 0 80v352a48 48 0 0 0 48 48h137.25V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.27c-30.81 0-40.42 19.12-40.42 38.73V256h68.78l-11 71.69h-57.78V480H400a48 48 0 0 0 48-48V80a48 48 0 0 0-48-48z"></path></svg></a></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"siteTitle":"Hlog - Code for good, not for food","frontmatter":{"author":"Hieu Phan","date":"2020-06-11T14:55:00.000Z","image":"/images/2-difference-copy-and-add-in-dockerfile/cover.jpg","title":"Dockerfile: COPY khác ADD?","readDuration":"10 min","categories":["Docker"]},"markdownBody":"\nNếu bạn thường build docker image hoặc đọc các tài liệu về docker, thỉnh thoảng bạn sẽ gặp `COPY` và `ADD`. Vậy `COPY` khác `ADD` có gì khác nhau? Nên sử dụng cái nào?\n\nCả `COPY` và `ADD` có một chức năng chung là chép file từ 1 nơi nào đó vào bên trong docker image. Còn điểm khác nhau?\n\n## COPY\n\n`COPY` cho phép bạn chép 1 file từ đĩa cứng vào docker image.\n\n## ADD\n\n`ADD`ngoài chức năng chép file từ đĩa cứng, còn hỗ trợ chép file từ 2 nguồn khác là:\n- Chép file từ 1 URL\n- Giải nén file tar vào docker image. Ví dụ `ADD http://abc.com/app.tar.xz /app/`, các file bên trong file `app.tar.xz` sẽ được chép vào `/app/` trong docker image.\n\n## Khi nào nên dùng `COPY`, khi nào nên dùng `ADD`?\nRiêng cá nhân mình, thì mình đa số dùng `COPY`, và rất ít dùng `ADD`. Vậy có phải mình đã bỏ qua 1 tính của docker là chép file từ url hay giải nén.\n\n\u003e Docker image khi build sẽ tạo ra nhiều layer. Ứng với mỗi lệnh trong Dockerfile, sẽ có 1 layer được sinh ra. Khi dùng lệnh `ADD` để download file, và file đó sẽ được lưu mãi mãi tại layer của lệnh `ADD` đó. Trường hợp file cần download có dung lượng khoảng vài GB, nhưng chỉ dùng tạm để build app, và có thể xoá cũng không thể ảnh hưởng đến app, thì dùng `ADD` kích thước docker image sẽ rất lớn.\n\n**Tip:** Với việc download file mình sẽ `curl` thay thế cho `ADD`.\nVí dụ\n\n```Dockerfile\nRUN curl -O https://example.com/files/abc.tar.gz \u0026\u0026 \\\n    tar -xzf abc.tar.gz \u0026\u0026 \\\n    echo \"do something\" \u0026\u0026 \\\n    rm -rf abc \u0026\u0026 \\\n    rm abc.tar.gz\n```\n\nNhư vậy docker sẽ lưu lại 1 layer, layer này không có file `abc.tar.gz`","categories":["ReactJS","Docker","GI/CD","Tip","Gitlab"]},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2-difference-copy-and-add-in-dockerfile"},"buildId":"hau1wfguwgaGlbPl6QppC","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/runtime/polyfills-b6cccdf50789f19d2e76.js"></script><script async="" data-next-page="/post/[slug]" src="/_next/static/hau1wfguwgaGlbPl6QppC/pages/post/%5Bslug%5D.js"></script><script async="" data-next-page="/_app" src="/_next/static/hau1wfguwgaGlbPl6QppC/pages/_app.js"></script><script src="/_next/static/runtime/webpack-b65cab0b00afd201cbda.js" async=""></script><script src="/_next/static/chunks/framework.2689030919a9ba0449ff.js" async=""></script><script src="/_next/static/chunks/commons.d3a5cad3addbd9214ed4.js" async=""></script><script src="/_next/static/runtime/main-48166c9d9d3fd61cbc12.js" async=""></script><script src="/_next/static/chunks/befb15d6b0d1c5c733afbaacd2f90d2058634f4f.a144523e91ee69682f24.js" async=""></script><script src="/_next/static/hau1wfguwgaGlbPl6QppC/_buildManifest.js" async=""></script><script src="/_next/static/hau1wfguwgaGlbPl6QppC/_ssgManifest.js" async=""></script></body></html>