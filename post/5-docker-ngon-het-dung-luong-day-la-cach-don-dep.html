<!DOCTYPE html><html><head><link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&amp;display=swap" rel="stylesheet"/><title>Docker ngốn hết dung lượng. Đây là cách dọn dẹp? - Hlog - Code for fun</title><meta name="viewport" content="initial-scale=1.0, width=device-width"/><meta charSet="utf-8"/><meta name="description" content="

## 1. Container
### 1.1. Stop and remove all containers

```bash
docker stop $(docker ps -aq)
docker rm $(docker ps -aq)
```

### 1.2. Remove idle container

```bash
docker rm $(docker ps -a -f stat"/><meta property="og:type" content="article"/><meta property="og:title" content="Docker ngốn hết dung lượng. Đây là cách dọn dẹp? - Hlog - Code for fun"/><meta property="og:description" content="

## 1. Container
### 1.1. Stop and remove all containers

```bash
docker stop $(docker ps -aq)
docker rm $(docker ps -aq)
```

### 1.2. Remove idle container

```bash
docker rm $(docker ps -a -f stat"/><meta property="og:image" content="https://phanletrunghieu.github.io/images/5-docker-ngon-het-dung-luong-day-la-cach-don-dep/cover.jpg"/><meta name="next-head-count" content="8"/><link rel="preload" href="/_next/static/css/8537a22d1fe977ad51c0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8537a22d1fe977ad51c0.css"/><link rel="preload" href="/_next/static/css/dcd1edf90b6e9b170e2b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/dcd1edf90b6e9b170e2b.css"/><link rel="preload" href="/_next/static/qCGgDXJJwko3t0CyeBwOA/pages/post/%5Bslug%5D.js" as="script"/><link rel="preload" href="/_next/static/qCGgDXJJwko3t0CyeBwOA/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-b65cab0b00afd201cbda.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.2689030919a9ba0449ff.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.d3a5cad3addbd9214ed4.js" as="script"/><link rel="preload" href="/_next/static/chunks/c2df9c76220e7cb45d7130e7e451d922ce893dc5.e0b3d670b033b1889366.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-27122c53c6c061494a08.js" as="script"/><link rel="preload" href="/_next/static/chunks/6183a2d0f59cf8176c1717699eb0a6b833139627.1cf5cae86f3d15225359.js" as="script"/></head><body><div id="__next"><div><div><div class="Header_container__13qZs"><h2 class="Header_logo__1ZEvY">Hlog</h2><div><span class="Header_category__10c-V">ReactJS</span><span class="Header_category__10c-V">K8s</span><span class="Header_category__10c-V">Docker</span><span class="Header_category__10c-V">GI/CD</span><span class="Header_category__10c-V">Tip</span><span class="Header_category__10c-V">Gitlab</span><span class="Header_category__10c-V">Microservice</span></div><div></div></div><div style="margin-top:120px;margin-bottom:50px"><div class="Post_headerContainer__2SstR"><h1>Docker ngốn hết dung lượng. Đây là cách dọn dẹp?</h1><div class="Post_subHeader__2A2DV"><p class="Post_date__3SBQj">Jun 20 2020</p><span class="Post_readDuration__WqJgS">15 min</span></div></div><div style="background-image:url(/images/5-docker-ngon-het-dung-luong-day-la-cach-don-dep/cover.jpg);background-size:cover;background-position:center;width:100%;height:0"></div><div class="Post_content__3ENjB"><h2>1. Container</h2><h3>1.1. Stop and remove all containers</h3><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">docker stop <span class="token" style="color:#e90"><span class="token" style="color:#e90">$(</span>docker <span class="token" style="color:#DD4A68">ps</span> -aq<span class="token" style="color:#e90">)</span></span>
docker <span class="token" style="color:#DD4A68">rm</span> <span class="token" style="color:#e90"><span class="token" style="color:#e90">$(</span>docker <span class="token" style="color:#DD4A68">ps</span> -aq<span class="token" style="color:#e90">)</span></span></code></pre><h3>1.2. Remove idle container</h3><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">docker <span class="token" style="color:#DD4A68">rm</span> <span class="token" style="color:#e90"><span class="token" style="color:#e90">$(</span>docker <span class="token" style="color:#DD4A68">ps</span> -a -f <span class="token assign-left" style="color:#e90">status</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span>exited -f <span class="token assign-left" style="color:#e90">status</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span>created -q<span class="token" style="color:#e90">)</span></span></code></pre><h2>2. Volume</h2><h3>2.1. Remove dangling volumes</h3><p>Yêu cầu: Docker 1.9 and later</p><p>Dangling volumes là những volumes không liên kết với bất kỳ 1 container nào.</p><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">docker volume prune</code></pre><h3>2.2. Remove container &amp; it&#x27;s volumes</h3><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">docker <span class="token" style="color:#DD4A68">rm</span> -v container_name</code></pre><h2>3. Image</h2><h3>3.1. Remove unsed images</h3><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">docker rmi <span class="token" style="color:#e90"><span class="token" style="color:#e90">$(</span>docker images -a -q<span class="token" style="color:#e90">)</span></span></code></pre><h3>3.2. Remove dangling images</h3><p>Dangling images là những images có tag là <code>&lt;none&gt;</code>.</p><p>Khi bạn dùng multistage để build 1 image thì sẽ xuất hiện những images kiểu thế này. Việc giữ lại những image này sẽ giúp bạn build nhanh hơn trong những lần tới, nhưng thường nó cũng ngốn dung lượng khá lớn. Hãy cân nhắc kỹ trước khi xóa nó.</p><p><strong>List</strong></p><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">docker images -f <span class="token assign-left" style="color:#e90">dangling</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span>true</code></pre><p><strong>Remove</strong></p><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">docker images purge</code></pre><h2>4. Remove Unused/Dangling Images, Containers, Volumes, and Networks</h2><p>Docker cung cấp 1 command duy nhất để xóa những thứ không cần thiết. Bạn có thể thử. Nhưng nếu 1 ngày bạn chạy lệnh này rồi mà thấy đĩa cứng vẫn bị ngốn dung lượng một cách bí ẩn, hãy thử dùng các lệnh ở trên.</p><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">docker system prune</code></pre><p><strong>Include unused images (not just dangling images)</strong></p><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">docker system prune -a</code></pre><h2>5. Giới hạn logs của docker</h2><p>Khi bạn chạy lệnh <code>docker logs container_name</code>, bạn sẽ xem được logs của container đó. Mỗi 1 container sẽ có logs riêng của nó. Mặc định, docker sẽ không giớ hạn số lượng/dung lượng logs của 1 container. Logs quá nhiều dấn đến disk của bạn cũng bị chiếm nhiều dung lượng</p><blockquote><p>Log là 1 trong những tác nhân gây ngốn dung lượng <strong>một cách thầm lặng</strong> mà bạn sẽ khó mà nghĩ đến</p></blockquote><p>Vì thế, ta cần giới hạn logs của mỗi container.</p><p>Tìm đến file <code>/etc/docker/daemon.json</code> (nếu không có thì tạo file mới). Thêm vào file đó với nội dung như sau:</p><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#999">{</span>
  <span class="token" style="color:#905">&quot;log-driver&quot;</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span> <span class="token" style="color:#690">&quot;json-file&quot;</span><span class="token" style="color:#999">,</span>
  <span class="token" style="color:#905">&quot;log-opts&quot;</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span> <span class="token" style="color:#999">{</span>
    <span class="token" style="color:#905">&quot;max-size&quot;</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span> <span class="token" style="color:#690">&quot;10m&quot;</span><span class="token" style="color:#999">,</span>
    <span class="token" style="color:#905">&quot;max-file&quot;</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span> <span class="token" style="color:#690">&quot;3&quot;</span>
  <span class="token" style="color:#999">}</span>
<span class="token" style="color:#999">}</span></code></pre><ul><li><strong>max-file:</strong> số lượng file logs tối đa của 1 container</li><li><strong>max-size:</strong> dung lượng tối đa của 1 file log mà 1 container sở hữu</li></ul><p>Từ config trên =&gt; 1 container có tối đa 3 file log, 1 file log có dung lượng tối đa 10MB. =&gt; Log tối đa 30MB.</p><p>Khi log đã ghi hết file thứ 3, thì file thứ 1 (cũ nhất) sẽ bị xoá để ghi log mới.</p></div><div class="Post_comments__v-xdT"><div><div class="fb-comments" data-href="https://phanletrunghieu.github.io/post/5-docker-ngon-het-dung-luong-day-la-cach-don-dep"></div></div></div></div><div><div class="Footer_content__3hdD7"><div class="Footer_logo__2F2BD">Hlog</div><div class="Footer_iconContainer__3ouva"><a target="_blank" href="https://github.com/phanletrunghieu"><svg class="Footer_logoSvg__XMKMu" data-prefix="fab" data-icon="github-square" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM277.3 415.7c-8.4 1.5-11.5-3.7-11.5-8 0-5.4.2-33 .2-55.3 0-15.6-5.2-25.5-11.3-30.7 37-4.1 76-9.2 76-73.1 0-18.2-6.5-27.3-17.1-39 1.7-4.3 7.4-22-1.7-45-13.9-4.3-45.7 17.9-45.7 17.9-13.2-3.7-27.5-5.6-41.6-5.6-14.1 0-28.4 1.9-41.6 5.6 0 0-31.8-22.2-45.7-17.9-9.1 22.9-3.5 40.6-1.7 45-10.6 11.7-15.6 20.8-15.6 39 0 63.6 37.3 69 74.3 73.1-4.8 4.3-9.1 11.7-10.6 22.3-9.5 4.3-33.8 11.7-48.3-13.9-9.1-15.8-25.5-17.1-25.5-17.1-16.2-.2-1.1 10.2-1.1 10.2 10.8 5 18.4 24.2 18.4 24.2 9.7 29.7 56.1 19.7 56.1 19.7 0 13.9.2 36.5.2 40.6 0 4.3-3 9.5-11.5 8-66-22.1-112.2-84.9-112.2-158.3 0-91.8 70.2-161.5 162-161.5S388 165.6 388 257.4c.1 73.4-44.7 136.3-110.7 158.3zm-98.1-61.1c-1.9.4-3.7-.4-3.9-1.7-.2-1.5 1.1-2.8 3-3.2 1.9-.2 3.7.6 3.9 1.9.3 1.3-1 2.6-3 3zm-9.5-.9c0 1.3-1.5 2.4-3.5 2.4-2.2.2-3.7-.9-3.7-2.4 0-1.3 1.5-2.4 3.5-2.4 1.9-.2 3.7.9 3.7 2.4zm-13.7-1.1c-.4 1.3-2.4 1.9-4.1 1.3-1.9-.4-3.2-1.9-2.8-3.2.4-1.3 2.4-1.9 4.1-1.5 2 .6 3.3 2.1 2.8 3.4zm-12.3-5.4c-.9 1.1-2.8.9-4.3-.6-1.5-1.3-1.9-3.2-.9-4.1.9-1.1 2.8-.9 4.3.6 1.3 1.3 1.8 3.3.9 4.1zm-9.1-9.1c-.9.6-2.6 0-3.7-1.5s-1.1-3.2 0-3.9c1.1-.9 2.8-.2 3.7 1.3 1.1 1.5 1.1 3.3 0 4.1zm-6.5-9.7c-.9.9-2.4.4-3.5-.6-1.1-1.3-1.3-2.8-.4-3.5.9-.9 2.4-.4 3.5.6 1.1 1.3 1.3 2.8.4 3.5zm-6.7-7.4c-.4.9-1.7 1.1-2.8.4-1.3-.6-1.9-1.7-1.5-2.6.4-.6 1.5-.9 2.8-.4 1.3.7 1.9 1.8 1.5 2.6z"></path></svg></a><a target="_blank" href="https://www.linkedin.com/in/phanletrunghieu"><svg class="Footer_logoSvg__XMKMu" data-prefix="fab" data-icon="linkedin" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a><a target="_blank" href="https://www.facebook.com/phanletrunghieu"><svg class="Footer_logoSvg__XMKMu" data-prefix="fab" data-icon="facebook-square" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M400 32H48A48 48 0 0 0 0 80v352a48 48 0 0 0 48 48h137.25V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.27c-30.81 0-40.42 19.12-40.42 38.73V256h68.78l-11 71.69h-57.78V480H400a48 48 0 0 0 48-48V80a48 48 0 0 0-48-48z"></path></svg></a></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"slug":"5-docker-ngon-het-dung-luong-day-la-cach-don-dep","siteTitle":"Hlog - Code for fun","frontmatter":{"author":"Hieu Phan","date":"2020-06-20T09:26:00.000Z","image":"/images/5-docker-ngon-het-dung-luong-day-la-cach-don-dep/cover.jpg","title":"Docker ngốn hết dung lượng. Đây là cách dọn dẹp?","readDuration":"15 min","categories":["Docker"]},"markdownBody":"\n\n## 1. Container\n### 1.1. Stop and remove all containers\n\n```bash\ndocker stop $(docker ps -aq)\ndocker rm $(docker ps -aq)\n```\n\n### 1.2. Remove idle container\n\n```bash\ndocker rm $(docker ps -a -f status=exited -f status=created -q)\n```\n\n## 2. Volume\n### 2.1. Remove dangling volumes\nYêu cầu: Docker 1.9 and later\n\nDangling volumes là những volumes không liên kết với bất kỳ 1 container nào.\n\n```bash\ndocker volume prune\n```\n\n### 2.2. Remove container \u0026 it's volumes\n\n```bash\ndocker rm -v container_name\n```\n\n## 3. Image\n### 3.1. Remove unsed images\n\n```bash\ndocker rmi $(docker images -a -q)\n```\n\n### 3.2. Remove dangling images\n\nDangling images là những images có tag là `\u003cnone\u003e`.\n\nKhi bạn dùng multistage để build 1 image thì sẽ xuất hiện những images kiểu thế này. Việc giữ lại những image này sẽ giúp bạn build nhanh hơn trong những lần tới, nhưng thường nó cũng ngốn dung lượng khá lớn. Hãy cân nhắc kỹ trước khi xóa nó.\n\n**List**\n```bash\ndocker images -f dangling=true\n```\n\n**Remove**\n```bash\ndocker images purge\n```\n\n## 4. Remove Unused/Dangling Images, Containers, Volumes, and Networks\n\nDocker cung cấp 1 command duy nhất để xóa những thứ không cần thiết. Bạn có thể thử. Nhưng nếu 1 ngày bạn chạy lệnh này rồi mà thấy đĩa cứng vẫn bị ngốn dung lượng một cách bí ẩn, hãy thử dùng các lệnh ở trên.\n\n```bash\ndocker system prune\n```\n\n**Include unused images (not just dangling images)**\n```bash\ndocker system prune -a\n```\n\n## 5. Giới hạn logs của docker\n\nKhi bạn chạy lệnh `docker logs container_name`, bạn sẽ xem được logs của container đó. Mỗi 1 container sẽ có logs riêng của nó. Mặc định, docker sẽ không giớ hạn số lượng/dung lượng logs của 1 container. Logs quá nhiều dấn đến disk của bạn cũng bị chiếm nhiều dung lượng\n\n\u003e Log là 1 trong những tác nhân gây ngốn dung lượng **một cách thầm lặng** mà bạn sẽ khó mà nghĩ đến\n\nVì thế, ta cần giới hạn logs của mỗi container.\n\nTìm đến file `/etc/docker/daemon.json` (nếu không có thì tạo file mới). Thêm vào file đó với nội dung như sau:\n\n```json\n{\n  \"log-driver\": \"json-file\",\n  \"log-opts\": {\n    \"max-size\": \"10m\",\n    \"max-file\": \"3\"\n  }\n}\n```\n\n- **max-file:** số lượng file logs tối đa của 1 container\n- **max-size:** dung lượng tối đa của 1 file log mà 1 container sở hữu\n\nTừ config trên =\u003e 1 container có tối đa 3 file log, 1 file log có dung lượng tối đa 10MB. =\u003e Log tối đa 30MB.\n\nKhi log đã ghi hết file thứ 3, thì file thứ 1 (cũ nhất) sẽ bị xoá để ghi log mới.","categories":["ReactJS","K8s","Docker","GI/CD","Tip","Gitlab","Microservice"],"host":"https://phanletrunghieu.github.io"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"5-docker-ngon-het-dung-luong-day-la-cach-don-dep"},"buildId":"qCGgDXJJwko3t0CyeBwOA","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/runtime/polyfills-16ccf9440fd1c9275fd4.js"></script><script async="" data-next-page="/post/[slug]" src="/_next/static/qCGgDXJJwko3t0CyeBwOA/pages/post/%5Bslug%5D.js"></script><script async="" data-next-page="/_app" src="/_next/static/qCGgDXJJwko3t0CyeBwOA/pages/_app.js"></script><script src="/_next/static/runtime/webpack-b65cab0b00afd201cbda.js" async=""></script><script src="/_next/static/chunks/framework.2689030919a9ba0449ff.js" async=""></script><script src="/_next/static/chunks/commons.d3a5cad3addbd9214ed4.js" async=""></script><script src="/_next/static/chunks/c2df9c76220e7cb45d7130e7e451d922ce893dc5.e0b3d670b033b1889366.js" async=""></script><script src="/_next/static/runtime/main-27122c53c6c061494a08.js" async=""></script><script src="/_next/static/chunks/6183a2d0f59cf8176c1717699eb0a6b833139627.1cf5cae86f3d15225359.js" async=""></script><script src="/_next/static/qCGgDXJJwko3t0CyeBwOA/_buildManifest.js" async=""></script><script src="/_next/static/qCGgDXJJwko3t0CyeBwOA/_ssgManifest.js" async=""></script></body></html>